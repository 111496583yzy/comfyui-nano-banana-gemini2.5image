# Gemini ComfyUI Plugin

ä¸€ä¸ªå¼ºå¤§çš„ ComfyUI æ’ä»¶ï¼Œé›†æˆ Google Gemini API çš„å›¾åƒç”Ÿæˆå’Œç¼–è¾‘åŠŸèƒ½ã€‚æ”¯æŒçº¯æ–‡æœ¬ç”Ÿæˆå›¾åƒå’ŒåŸºäºç°æœ‰å›¾åƒçš„æ™ºèƒ½ç¼–è¾‘ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ **å›¾åƒç”Ÿæˆ**: ä½¿ç”¨ Gemini æ¨¡å‹ä»æ–‡æœ¬æç¤ºç”Ÿæˆé«˜è´¨é‡å›¾åƒ
- ğŸ–¼ï¸ **å›¾åƒç¼–è¾‘**: åŸºäºè¾“å…¥å›¾åƒå’Œæ–‡æœ¬æŒ‡ä»¤è¿›è¡Œæ™ºèƒ½ç¼–è¾‘
- ğŸ“ **é•¿å®½æ¯”æ§åˆ¶**: æ”¯æŒå¤šç§å›¾åƒå°ºå¯¸æ¯”ä¾‹ (1:1, 9:16, 16:9, 3:4, 4:3, 3:2, 2:3, 5:4, 4:5, 21:9)
- ğŸŒ **é•œåƒç«™æ”¯æŒ**: æ”¯æŒè‡ªå®šä¹‰APIåœ°å€ï¼Œé€‚é…å›½å†…é•œåƒç«™å’Œä»£ç†æœåŠ¡
- ğŸ¤– **å¤šå¹³å°AI**: æ”¯æŒOpenRouterç»Ÿä¸€æ¥å£ï¼Œè®¿é—®GPT-4ã€Claudeã€Llamaç­‰å¤šç§æ¨¡å‹
- ğŸ‘ï¸ **è§†è§‰åˆ†æ**: å¼ºå¤§çš„å›¾åƒç†è§£å’Œåˆ†æèƒ½åŠ›
- ğŸ”„ **æ™ºèƒ½é‡è¯•**: å†…ç½®é™æµå¤„ç†å’Œé”™è¯¯æ¢å¤æœºåˆ¶
- ğŸš€ **å¤šæ¨¡å‹æ”¯æŒ**: æ”¯æŒæœ€æ–°çš„ Gemini 2.5 å’Œ 2.0 æ¨¡å‹
- ğŸ›¡ï¸ **ç¨³å®šæ€§**: å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œè¶…æ—¶ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### è·å– API Key

#### Google Gemini API Key
1. è®¿é—® [Google AI Studio](https://makersuite.google.com/app/apikey)
2. åˆ›å»ºæ–°çš„ API Key
3. åœ¨GeminièŠ‚ç‚¹ä¸­è¾“å…¥ä½ çš„ API Key

#### OpenRouter API Key
1. è®¿é—® [OpenRouter](https://openrouter.ai/keys)
2. æ³¨å†Œè´¦æˆ·å¹¶åˆ›å»º API Key
3. åœ¨OpenRouterèŠ‚ç‚¹ä¸­è¾“å…¥ä½ çš„ API Key (æ ¼å¼: sk-or-v1-...)

#### å…³äº site_url å‚æ•°
- **ç”¨é€”**: OpenRouterç”¨äºç»Ÿè®¡APIä½¿ç”¨æ¥æºå’Œè®¡è´¹è¿½è¸ª
- **å¯é€‰**: ä¸å¡«å†™ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ
- **å»ºè®®**: å¡«å†™ä½ çš„é¡¹ç›®ç½‘ç«™URLï¼Œæœ‰åŠ©äºï¼š
  - è·å¾—æ›´å¥½çš„æŠ€æœ¯æ”¯æŒ
  - å‚ä¸OpenRouterçš„å¼€å‘è€…è®¡åˆ’
  - é€æ˜çš„ä½¿ç”¨ç»Ÿè®¡
- **ç¤ºä¾‹**: `https://github.com/your-username/your-project`

## ğŸ“¦ èŠ‚ç‚¹è¯´æ˜

### Gemini å›¾ç‰‡ç”Ÿæˆ (GeminiImageGeneration)

ä»æ–‡æœ¬æç¤ºç”Ÿæˆå…¨æ–°å›¾åƒã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: Google Gemini API å¯†é’¥
- `prompt`: å›¾åƒç”Ÿæˆæç¤ºè¯
- `model`: é€‰æ‹©æ¨¡å‹ (gemini-2.5-flash-image-preview æˆ– gemini-2.0-flash-preview-image-generation)
- `aspect_ratio`: å›¾åƒé•¿å®½æ¯” (1:1, 9:16, 16:9, 3:4, 4:3, 3:2, 2:3, 5:4, 4:5, 21:9)
- `temperature`: åˆ›é€ æ€§æ§åˆ¶ (0.0-2.0)
- `top_p`: é‡‡æ ·æ§åˆ¶ (0.0-1.0)
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°

**è¾“å‡º:**
- `image`: ç”Ÿæˆçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

### Gemini å›¾ç‰‡ç¼–è¾‘ (GeminiImageEdit)

åŸºäºè¾“å…¥å›¾åƒè¿›è¡Œæ™ºèƒ½ç¼–è¾‘ï¼Œæ”¯æŒå•å›¾å’Œå¤šå›¾æ‰¹é‡å¤„ç†ã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: Google Gemini API å¯†é’¥
- `images`: è¾“å…¥å›¾åƒ (IMAGE ç±»å‹ï¼Œæ”¯æŒæ‰¹é‡)
- `prompt`: ç¼–è¾‘æŒ‡ä»¤
- `model`: é€‰æ‹©æ¨¡å‹
- `aspect_ratio`: å›¾åƒé•¿å®½æ¯” (1:1, 9:16, 16:9, 3:4, 4:3, 3:2, 2:3, 5:4, 4:5, 21:9)
- `temperature`: åˆ›é€ æ€§æ§åˆ¶
- `top_p`: é‡‡æ ·æ§åˆ¶
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°
- `process_mode`: å¤„ç†æ¨¡å¼
  - `each_image_separately`: åˆ†åˆ«å¤„ç†æ¯å¼ å›¾ç‰‡ (é»˜è®¤)
  - `all_images_combined`: æ‰€æœ‰å›¾ç‰‡åˆå¹¶å¤„ç†
  - `first_image_only`: ä»…å¤„ç†ç¬¬ä¸€å¼ å›¾ç‰‡

**è¾“å‡º:**
- `edited_image`: ç¼–è¾‘åçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

**å¤„ç†æ¨¡å¼è¯´æ˜:**
- **each_image_separately**: å¯¹æ¯å¼ å›¾ç‰‡å•ç‹¬å¤„ç†ï¼Œé€‚åˆä¸ªæ€§åŒ–ç¼–è¾‘
- **all_images_combined**: å°†æ‰€æœ‰å›¾ç‰‡ä¸€èµ·å¤„ç†ï¼Œé€‚åˆä¿æŒé£æ ¼ä¸€è‡´æ€§
- **first_image_only**: åªå¤„ç†ç¬¬ä¸€å¼ å›¾ç‰‡ï¼Œé€‚åˆå¿«é€Ÿæµ‹è¯•

### Gemini é•œåƒç«™å›¾ç‰‡ç”Ÿæˆ (GeminiMirrorImageGeneration)

æ”¯æŒè‡ªå®šä¹‰APIåœ°å€çš„å›¾åƒç”ŸæˆèŠ‚ç‚¹ï¼Œé€‚é…å›½å†…é•œåƒç«™ã€‚

**è¾“å…¥å‚æ•°:**
- `api_url`: è‡ªå®šä¹‰APIåœ°å€ (å¦‚: https://ai.comfly.chat)
- `api_key`: API å¯†é’¥
- `prompt`: å›¾åƒç”Ÿæˆæç¤ºè¯
- `model`: é€‰æ‹©æ¨¡å‹
- `temperature`: åˆ›é€ æ€§æ§åˆ¶
- `top_p`: é‡‡æ ·æ§åˆ¶
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°

**è¾“å‡º:**
- `image`: ç”Ÿæˆçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

### Gemini é•œåƒç«™å›¾ç‰‡ç¼–è¾‘ (GeminiMirrorImageEdit)

æ”¯æŒè‡ªå®šä¹‰APIåœ°å€çš„å›¾åƒç¼–è¾‘èŠ‚ç‚¹ï¼Œé€‚é…å›½å†…é•œåƒç«™ã€‚

**è¾“å…¥å‚æ•°:**
- `api_url`: è‡ªå®šä¹‰APIåœ°å€ (å¦‚: https://ai.comfly.chat)
- `api_key`: API å¯†é’¥
- `image`: è¾“å…¥å›¾åƒ (IMAGE ç±»å‹)
- `prompt`: ç¼–è¾‘æŒ‡ä»¤
- `model`: é€‰æ‹©æ¨¡å‹
- `temperature`: åˆ›é€ æ€§æ§åˆ¶
- `top_p`: é‡‡æ ·æ§åˆ¶
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°

**è¾“å‡º:**
- `edited_image`: ç¼–è¾‘åçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

### OpenRouter è§†è§‰åˆ†æ (OpenRouterMirror)

ä½¿ç”¨OpenRouterç»Ÿä¸€æ¥å£è®¿é—®å¤šç§AIæ¨¡å‹è¿›è¡Œå›¾åƒåˆ†æå’Œç†è§£ã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: OpenRouter API å¯†é’¥
- `prompt`: åˆ†ææŒ‡ä»¤æˆ–é—®é¢˜
- `model`: é€‰æ‹©æ¨¡å‹ (æ”¯æŒGPT-4oã€Claude-3.5ã€Geminiã€Llamaç­‰)
- `max_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•° (1-8192)
- `temperature`: åˆ›é€ æ€§æ§åˆ¶ (0.0-2.0)
- `top_p`: é‡‡æ ·æ§åˆ¶ (0.0-1.0)
- `images`: è¾“å…¥å›¾åƒ (å¯é€‰ï¼ŒIMAGE ç±»å‹)
- `site_url`: ç½‘ç«™URL (å¯é€‰ï¼Œç”¨äºç»Ÿè®¡)
- `app_name`: åº”ç”¨åç§° (å¯é€‰ï¼Œé»˜è®¤ComfyUI)

**è¾“å‡º:**
- `response_text`: AIåˆ†æç»“æœæ–‡æœ¬
- `model_info`: æ¨¡å‹ä½¿ç”¨ä¿¡æ¯å’Œtokenç»Ÿè®¡

### OpenRouter æ–‡æœ¬ç”Ÿæˆ (OpenRouterTextGeneration)

ä½¿ç”¨OpenRouteræ¥å£è¿›è¡Œçº¯æ–‡æœ¬ç”Ÿæˆï¼Œæ”¯æŒå¤šç§å…ˆè¿›AIæ¨¡å‹ã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: OpenRouter API å¯†é’¥
- `prompt`: æ–‡æœ¬ç”Ÿæˆæç¤º
- `model`: é€‰æ‹©æ¨¡å‹ (GPT-4oã€Claudeã€Llamaã€Mistralç­‰)
- `max_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•° (1-8192)
- `temperature`: åˆ›é€ æ€§æ§åˆ¶ (0.0-2.0)
- `top_p`: é‡‡æ ·æ§åˆ¶ (0.0-1.0)
- `system_prompt`: ç³»ç»Ÿæç¤º (å¯é€‰)
- `site_url`: ç½‘ç«™URL (å¯é€‰)
- `app_name`: åº”ç”¨åç§° (å¯é€‰)

**è¾“å‡º:**
- `response_text`: ç”Ÿæˆçš„æ–‡æœ¬å†…å®¹
- `model_info`: æ¨¡å‹ä½¿ç”¨ä¿¡æ¯å’Œtokenç»Ÿè®¡

### OpenRouter Gemini å›¾åƒç”Ÿæˆ (OpenRouterGeminiImageGeneration)

ä½¿ç”¨OpenRouteræ¥å£è°ƒç”¨Google Geminiæ¨¡å‹è¿›è¡Œå›¾åƒç”Ÿæˆï¼Œä¸“æ³¨äºGeminiçš„å¤šæ¨¡æ€èƒ½åŠ›ã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: OpenRouter API å¯†é’¥
- `prompt`: å›¾åƒç”Ÿæˆæç¤ºè¯
- `model`: é€‰æ‹©Geminiæ¨¡å‹
  - `google/gemini-2.5-flash-image-preview` (æ¨è)
  - `google/gemini-2.5-flash-image-preview:free` (ğŸ†“ **å…è´¹æ¨¡å‹**: æ¯å¤©50å¼ )
  - `google/gemini-2.0-flash-preview-image-generation`
- `temperature`: åˆ›é€ æ€§æ§åˆ¶ (0.0-2.0)
- `top_p`: é‡‡æ ·æ§åˆ¶ (0.0-1.0)
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•° (1-32768)
- `seed`: éšæœºç§å­ (0ä¸ºè‡ªåŠ¨éšæœºï¼Œå…¶ä»–å€¼ç”¨äºå¯é‡å¤ç”Ÿæˆ)
- `site_url`: ç½‘ç«™URL (å¯é€‰)
- `app_name`: åº”ç”¨åç§° (å¯é€‰)

**è¾“å‡º:**
- `generated_image`: ç”Ÿæˆçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: Geminiçš„æ–‡æœ¬å“åº”

**ç‰¹è‰²åŠŸèƒ½:**
- ä¸“é—¨é’ˆå¯¹Google Geminiæ¨¡å‹ä¼˜åŒ–
- æ”¯æŒGeminiçš„å¤šæ¨¡æ€è¾“å‡ºæ ¼å¼
- åŒæ—¶è¿”å›å›¾åƒå’Œæ–‡æœ¬æè¿°
- ä½¿ç”¨OpenRouterçš„ç»Ÿä¸€APIæ¥å£
- ğŸ†“ **å…è´¹æ¨¡å‹**: æ”¯æŒ`google/gemini-2.5-flash-image-preview:free`ï¼Œæ¯å¤©å¯å…è´¹ç”Ÿæˆ50å¼ å›¾ç‰‡
- ğŸ² **éšæœºç§å­æ§åˆ¶**: æ”¯æŒç§å­å‚æ•°ï¼Œå¯å®ç°å¯é‡å¤çš„å›¾åƒç”Ÿæˆ

### OpenRouter å›¾åƒç¼–è¾‘ (OpenRouterImageEdit)

ä½¿ç”¨OpenRouteræ¥å£å¯¹ç°æœ‰å›¾åƒè¿›è¡Œæ™ºèƒ½ç¼–è¾‘å’Œä¿®æ”¹ã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: OpenRouter API å¯†é’¥
- `images`: è¾“å…¥å›¾åƒ (IMAGE ç±»å‹ï¼Œæ”¯æŒæ‰¹é‡)
- `prompt`: ç¼–è¾‘æŒ‡ä»¤ (å¦‚ï¼š"è®©å¤©ç©ºå˜æˆæ—¥è½è‰²å½©"ã€"æ·»åŠ ä¸€åªçŒ«"ç­‰)
- `model`: é€‰æ‹©AIæ¨¡å‹ (GPT-4oã€GPT-4o-miniã€Gemini-2.5-flash)
- `temperature`: åˆ›é€ æ€§æ§åˆ¶ (0.0-2.0)
- `top_p`: é‡‡æ ·æ§åˆ¶ (0.0-1.0)
- `max_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•° (1-8192ï¼Œé»˜è®¤8192)
- `site_url`: ç½‘ç«™URL (å¯é€‰ï¼Œç”¨äºç»Ÿè®¡ï¼Œé»˜è®¤ComfyUI GitHub)
- `app_name`: åº”ç”¨åç§° (å¯é€‰ï¼Œé»˜è®¤ComfyUI)

**è¾“å‡º:**
- `edited_image`: ç¼–è¾‘åçš„å›¾åƒ (IMAGE ç±»å‹)
- `edit_description`: ç¼–è¾‘è¿‡ç¨‹çš„æ–‡å­—æè¿°

**ç¼–è¾‘èƒ½åŠ›:**
- ğŸ¨ **é£æ ¼è½¬æ¢**: æ”¹å˜å›¾åƒçš„è‰ºæœ¯é£æ ¼
- ğŸŒˆ **è‰²å½©è°ƒæ•´**: ä¿®æ”¹é¢œè‰²ã€äº®åº¦ã€å¯¹æ¯”åº¦
- â• **å†…å®¹æ·»åŠ **: åœ¨å›¾åƒä¸­æ·»åŠ æ–°å…ƒç´ 
- âœ‚ï¸ **å†…å®¹ç§»é™¤**: å»é™¤ä¸éœ€è¦çš„éƒ¨åˆ†
- ğŸ”„ **åœºæ™¯å˜æ¢**: æ”¹å˜èƒŒæ™¯æˆ–ç¯å¢ƒ
- ğŸ“ **æ„å›¾ä¼˜åŒ–**: è°ƒæ•´å›¾åƒå¸ƒå±€å’Œæ¯”ä¾‹

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### é•¿å®½æ¯”æ§åˆ¶

æ”¯æŒå¤šç§å›¾åƒå°ºå¯¸æ¯”ä¾‹ï¼Œæ»¡è¶³ä¸åŒä½¿ç”¨åœºæ™¯ï¼š

- **1:1** - æ­£æ–¹å½¢ï¼Œé€‚åˆç¤¾äº¤åª’ä½“å¤´åƒã€äº§å“å±•ç¤º
- **9:16** - ç«–å±ï¼Œé€‚åˆæ‰‹æœºå£çº¸ã€çŸ­è§†é¢‘
- **16:9** - æ¨ªå±ï¼Œé€‚åˆæ¡Œé¢å£çº¸ã€è§†é¢‘å°é¢
- **3:4** - ç«–å±ï¼Œé€‚åˆæµ·æŠ¥ã€å®£ä¼ å›¾
- **4:3** - æ¨ªå±ï¼Œé€‚åˆä¼ ç»Ÿç…§ç‰‡æ¯”ä¾‹
- **3:2** - æ¨ªå±ï¼Œé€‚åˆæ‘„å½±ä½œå“
- **2:3** - ç«–å±ï¼Œé€‚åˆæ‚å¿—å°é¢
- **5:4** - æ¨ªå±ï¼Œé€‚åˆè‰ºæœ¯ç”»ä½œ
- **4:5** - ç«–å±ï¼Œé€‚åˆInstagramå¸–å­
- **21:9** - è¶…å®½å±ï¼Œé€‚åˆç”µå½±æµ·æŠ¥ã€æ¨ªå¹…

### æ™ºèƒ½é‡è¯•æœºåˆ¶

- **æŒ‡æ•°é€€é¿**: è‡ªåŠ¨è°ƒæ•´é‡è¯•é—´éš”
- **é™æµå¤„ç†**: é’ˆå¯¹ 429 é”™è¯¯çš„ç‰¹æ®Šå¤„ç†
- **é”™è¯¯åˆ†ç±»**: æ ¹æ®ä¸åŒé”™è¯¯ç±»å‹é‡‡ç”¨ä¸åŒç­–ç•¥

### å›¾åƒå¤„ç†

- **æ ¼å¼è½¬æ¢**: è‡ªåŠ¨å¤„ç† RGB/RGBA è½¬æ¢
- **Base64 ç¼–ç **: é«˜æ•ˆçš„å›¾åƒæ•°æ®ä¼ è¾“
- **è´¨é‡ä¼˜åŒ–**: 95% JPEG è´¨é‡ä¿è¯

### é”™è¯¯å¤„ç†

- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„æ“ä½œè¿‡ç¨‹è®°å½•
- **å‹å¥½æç¤º**: æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- **ä¼˜é›…é™çº§**: å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

## ğŸ“‹ ä¾èµ–é¡¹

```
torch>=1.9.0          # æ·±åº¦å­¦ä¹ æ¡†æ¶
numpy>=1.21.0         # æ•°å€¼è®¡ç®—
Pillow>=8.0.0         # å›¾åƒå¤„ç†
requests>=2.25.0      # HTTP è¯·æ±‚

# å¯é€‰ä¾èµ–ï¼ˆä»…å½“ä½¿ç”¨Google APIæ—¶éœ€è¦ï¼‰
# google-genai>=0.3.0   # Google AI SDK
# google-cloud-aiplatform>=1.25.0
# google-auth>=2.0.0
# google-auth-oauthlib>=0.5.0
```

## ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å›¾åƒç”Ÿæˆ

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "Gemini å›¾ç‰‡ç”Ÿæˆ" èŠ‚ç‚¹
# è®¾ç½®å‚æ•°:
api_key = "your_gemini_api_key"
prompt = "A serene mountain landscape at sunset with a lake reflection"
model = "gemini-2.5-flash-image-preview"
aspect_ratio = "16:9"  # æ¨ªå±æ¯”ä¾‹ï¼Œé€‚åˆæ¡Œé¢å£çº¸
```

### å›¾åƒç¼–è¾‘

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "Gemini å›¾ç‰‡ç¼–è¾‘" èŠ‚ç‚¹
# è¿æ¥è¾“å…¥å›¾åƒå¹¶è®¾ç½®å‚æ•°:
prompt = "Add a rainbow in the sky"
aspect_ratio = "4:3"  # ä¼ ç»Ÿç…§ç‰‡æ¯”ä¾‹
```

### ä½¿ç”¨é•œåƒç«™

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "Gemini é•œåƒç«™å›¾ç‰‡ç”Ÿæˆ" èŠ‚ç‚¹
# è®¾ç½®è‡ªå®šä¹‰APIåœ°å€:
api_url = "https://ai.comfly.chat"  # æˆ–å…¶ä»–é•œåƒç«™åœ°å€
api_key = "your_api_key"
prompt = "A beautiful sunset over the ocean"
aspect_ratio = "21:9"  # è¶…å®½å±æ¯”ä¾‹ï¼Œé€‚åˆç”µå½±æµ·æŠ¥
```

### ä½¿ç”¨OpenRouterè¿›è¡Œå›¾åƒåˆ†æ

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "OpenRouter è§†è§‰åˆ†æ" èŠ‚ç‚¹
# è®¾ç½®å‚æ•°:
api_key = "sk-or-v1-your_openrouter_api_key"
prompt = "è¯·è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡ä¸­çš„å†…å®¹ï¼ŒåŒ…æ‹¬é¢œè‰²ã€æ„å›¾å’Œæƒ…æ„Ÿè¡¨è¾¾"
model = "openai/gpt-4o"  # æˆ–å…¶ä»–æ”¯æŒè§†è§‰çš„æ¨¡å‹
```

### ä½¿ç”¨OpenRouterè¿›è¡Œæ–‡æœ¬ç”Ÿæˆ

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "OpenRouter æ–‡æœ¬ç”Ÿæˆ" èŠ‚ç‚¹
# è®¾ç½®å‚æ•°:
api_key = "sk-or-v1-your_openrouter_api_key"
prompt = "å†™ä¸€é¦–å…³äºäººå·¥æ™ºèƒ½çš„è¯—"
model = "anthropic/claude-3.5-sonnet"
system_prompt = "ä½ æ˜¯ä¸€ä½å¯Œæœ‰åˆ›æ„çš„è¯—äºº"
```

### ä½¿ç”¨OpenRouterè¿›è¡ŒGeminiå›¾åƒç”Ÿæˆ

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "OpenRouter å¤šæ¨¡æ€å›¾åƒç”Ÿæˆ" èŠ‚ç‚¹
# è®¾ç½®å‚æ•°:
api_key = "sk-or-v1-your_openrouter_api_key"
prompt = "Generate a majestic dragon flying over a mystical forest at sunset, highly detailed, fantasy art style"
model = "google/gemini-2.5-flash-image-preview"  # æ¨èçš„Geminiæ¨¡å‹
aspect_ratio = "3:2"  # æ‘„å½±ä½œå“æ¯”ä¾‹
temperature = 1.0
top_p = 0.95
max_output_tokens = 8192
```

### ä½¿ç”¨OpenRouterè¿›è¡Œå›¾åƒç¼–è¾‘

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "OpenRouter å›¾åƒç¼–è¾‘" èŠ‚ç‚¹
# è¿æ¥è¾“å…¥å›¾åƒå¹¶è®¾ç½®å‚æ•°:
api_key = "sk-or-v1-your_openrouter_api_key"
prompt = "å°†è¿™å¼ å›¾ç‰‡çš„å¤©ç©ºæ”¹æˆç¾ä¸½çš„æ—¥è½è‰²å½©ï¼Œæ·»åŠ ä¸€äº›äº‘æœµ"
model = "openai/gpt-4o-mini"  # æ¨èç”¨äºå›¾åƒç¼–è¾‘
temperature = 0.7
max_tokens = 8192
site_url = "https://your-project-website.com"  # å¯é€‰ï¼šä½ çš„é¡¹ç›®ç½‘ç«™
```

## ğŸŒ æ”¯æŒçš„é•œåƒç«™

æ’ä»¶æ”¯æŒä»¥ä¸‹APIæ ¼å¼çš„é•œåƒç«™ï¼Œ**æ‰€æœ‰é•œåƒç«™åœ°å€éƒ½å¯ä»¥åœ¨èŠ‚ç‚¹ä¸­è‡ªå®šä¹‰é…ç½®**ï¼š

### Gemini åŸç”Ÿæ ¼å¼é•œåƒç«™
- `https://ai.comfly.chat` - ComflyAI é•œåƒç«™ï¼ˆé»˜è®¤ï¼‰
- `https://api.openai-proxy.com` - ä»£ç†æœåŠ¡
- å…¶ä»–å…¼å®¹ Gemini API æ ¼å¼çš„é•œåƒæœåŠ¡

### OpenRouter ç»Ÿä¸€æ¥å£
- `https://openrouter.ai` - OpenRouter å®˜æ–¹APIï¼ˆé»˜è®¤ï¼‰
- æ”¯æŒå¤šç§AIæ¨¡å‹ï¼š
  - **æ–‡æœ¬/è§†è§‰æ¨¡å‹**:
    - **OpenAI**: GPT-4o, GPT-4o-mini, GPT-3.5-turbo
    - **Anthropic**: Claude-3.5-sonnet, Claude-3-haiku
    - **Google**: Gemini-pro-1.5, Gemini-flash-1.5
    - **Meta**: Llama-3.1-405b, Llama-3.1-70b, Llama-3.2-90b-vision
    - **Qwen**: Qwen-2-vl-72b, Qwen-2-72b
    - **Microsoft**: Phi-3.5-vision
    - **Mistral**: Mistral-7b-instruct
  - **å›¾åƒç”Ÿæˆæ¨¡å‹**:
    - **Google Gemini**: gemini-2.5-flash-image-preview, gemini-2.5-flash-image-preview:free (ğŸ†“ æ¯å¤©50å¼ ), gemini-2.0-flash-preview-image-generation

### ğŸ”§ é•œåƒç«™é…ç½®è¯´æ˜

æ‰€æœ‰é•œåƒç«™èŠ‚ç‚¹éƒ½æ”¯æŒè‡ªå®šä¹‰é•œåƒç«™åœ°å€ï¼š

1. **ComflyGeminiMirror èŠ‚ç‚¹**ï¼š
   - é»˜è®¤åœ°å€ï¼š`https://ai.comfly.chat`
   - å‚æ•°åï¼š`mirror_url`
   - æ”¯æŒä»»ä½•å…¼å®¹ Gemini API æ ¼å¼çš„é•œåƒæœåŠ¡

2. **OpenRouter ç³»åˆ—èŠ‚ç‚¹**ï¼š
   - é»˜è®¤åœ°å€ï¼š`https://openrouter.ai`
   - å‚æ•°åï¼š`mirror_url`
   - æ”¯æŒä»»ä½•å…¼å®¹ OpenRouter API æ ¼å¼çš„é•œåƒæœåŠ¡

3. **é…ç½®ç¤ºä¾‹**ï¼š
   ```
   # ä½¿ç”¨è‡ªå®šä¹‰é•œåƒç«™
   mirror_url = "https://your-custom-mirror.com"
   
   # ä½¿ç”¨å®˜æ–¹æœåŠ¡
   mirror_url = "https://openrouter.ai"  # OpenRouter
   mirror_url = "https://ai.comfly.chat"  # Comfly
   ```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API é…é¢**: æ³¨æ„ API çš„ä½¿ç”¨é™åˆ¶
2. **ç½‘ç»œè¿æ¥**: ç¡®ä¿ç¨³å®šçš„ç½‘ç»œè¿æ¥
3. **å›¾åƒå¤§å°**: å¤§å›¾åƒå¯èƒ½éœ€è¦æ›´é•¿å¤„ç†æ—¶é—´
4. **æ¨¡å‹é€‰æ‹©**: ä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„ç‰¹æ€§å’Œé™åˆ¶
5. **å…è´¹æ¨¡å‹é™åˆ¶**: 
   - `google/gemini-2.5-flash-image-preview:free` æ¯å¤©é™åˆ¶50å¼ å›¾ç‰‡
   - å…è´¹é…é¢é‡ç½®æ—¶é—´ä»¥UTCæ—¶é—´ä¸ºå‡†
6. **éšæœºç§å­è¯´æ˜**:
   - è®¾ç½®ä¸º 0 æ—¶è‡ªåŠ¨ç”Ÿæˆéšæœºç§å­
   - ç›¸åŒç§å­+ç›¸åŒæç¤ºè¯å¯ä»¥ç”Ÿæˆç›¸ä¼¼çš„å›¾åƒ
   - ä¸åŒæ¨¡å‹çš„ç§å­æ•ˆæœå¯èƒ½ä¸åŒ

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**API Key é”™è¯¯**
- ç¡®ä¿ API Key æ ¼å¼æ­£ç¡®ä¸”æœ‰æ•ˆ
- æ£€æŸ¥ API Key æƒé™è®¾ç½®

**429 é™æµé”™è¯¯**
- ç­‰å¾…æ›´é•¿æ—¶é—´å†è¯•
- æ£€æŸ¥ API é…é¢è®¾ç½®
- è€ƒè™‘å‡çº§ API è®¡åˆ’

**ç½‘ç»œè¶…æ—¶**
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- å¢åŠ è¶…æ—¶æ—¶é—´è®¾ç½®

**å…è´¹æ¨¡å‹é…é¢ç”¨å®Œ**
- ç­‰å¾…æ¬¡æ—¥UTCæ—¶é—´é‡ç½®
- åˆ‡æ¢åˆ°ä»˜è´¹æ¨¡å‹
- æ£€æŸ¥OpenRouterè´¦æˆ·ä½™é¢

**å›¾åƒç”Ÿæˆå¤±è´¥**
- ç¡®ä¿æç¤ºè¯ç¬¦åˆå†…å®¹æ”¿ç­–
- æ£€æŸ¥å›¾åƒå°ºå¯¸å‚æ•°
- å°è¯•ä¸åŒçš„éšæœºç§å­

## ğŸ’¡ ä½¿ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ

### å›¾åƒç”Ÿæˆä¼˜åŒ–
- **æç¤ºè¯ä¼˜åŒ–**: ä½¿ç”¨æ¸…æ™°ã€å…·ä½“çš„æè¿°è¯
- **é£æ ¼æ§åˆ¶**: å¯ä»¥åœ¨æç¤ºè¯ä¸­æŒ‡å®šè‰ºæœ¯é£æ ¼ï¼Œå¦‚"photorealistic", "anime style", "watercolor painting"
- **ç»†èŠ‚æ§åˆ¶**: ä½¿ç”¨ä¿®é¥°è¯å¦‚"highly detailed", "8K resolution", "professional photography"

### ç§å­ä½¿ç”¨ç­–ç•¥
- **å®éªŒé˜¶æ®µ**: ä½¿ç”¨éšæœºç§å­(0)æ¢ç´¢ä¸åŒå¯èƒ½æ€§
- **å¾®è°ƒé˜¶æ®µ**: å›ºå®šç§å­å€¼ï¼Œä»…è°ƒæ•´æç¤ºè¯è¿›è¡Œç²¾ç»†æ§åˆ¶
- **æ‰¹é‡ç”Ÿæˆ**: ä½¿ç”¨ä¸åŒç§å­ç”Ÿæˆå¤šä¸ªå˜ä½“

### æ¨¡å‹é€‰æ‹©å»ºè®®
- **å¿«é€Ÿæµ‹è¯•**: ä½¿ç”¨å…è´¹æ¨¡å‹è¿›è¡Œåˆæ­¥å®éªŒ
- **é«˜è´¨é‡è¾“å‡º**: åˆ‡æ¢åˆ°ä»˜è´¹æ¨¡å‹è·å¾—æ›´å¥½æ•ˆæœ
- **æˆæœ¬æ§åˆ¶**: å…ˆç”¨å…è´¹æ¨¡å‹ç¡®å®šæ»¡æ„çš„æç¤ºè¯ï¼Œå†ç”¨ä»˜è´¹æ¨¡å‹ç”Ÿæˆæœ€ç»ˆç»“æœ

### å·¥ä½œæµç¨‹å»ºè®®
1. ä½¿ç”¨æ–‡æœ¬ç”ŸæˆèŠ‚ç‚¹å®Œå–„æç¤ºè¯
2. ç”¨å…è´¹å›¾åƒç”Ÿæˆæ¨¡å‹æµ‹è¯•æ•ˆæœ
3. è°ƒæ•´å‚æ•°å’Œç§å­å€¼
4. åˆ‡æ¢åˆ°ä»˜è´¹æ¨¡å‹ç”Ÿæˆé«˜è´¨é‡å›¾åƒ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issues å’Œ Pull Requests æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªå¼€æºè®¸å¯è¯ã€‚ä½¿ç”¨å‰è¯·ç¡®ä¿éµå®ˆç›¸å…³APIçš„ä½¿ç”¨æ¡æ¬¾ã€‚

---

**æ³¨æ„**: ä½¿ç”¨æœ¬æ’ä»¶éœ€è¦æœ‰æ•ˆçš„APIå¯†é’¥ã€‚è¯·ç¡®ä¿éµå®ˆç›¸å…³çš„ä½¿ç”¨æ¡æ¬¾å’Œé™åˆ¶ã€‚